# 경량의 공식 Node.js 12 이미지를 사용합니다.
# https://hub.docker.com/_/node
FROM node:12-slim

# 앱 디렉터리를 생성한 후 앱 디렉터리로 변경합니다.
WORKDIR /usr/src/app

# 애플리케이션 종속 항목 매니페스트를 컨테이너 이미지에 복사합니다.
# package.json과 package-lock.json이 모두 복사되도록 와일드 카드를 사용합니다(가능한 경우).
# 이것을 먼저 복사하면 코드가 변경될 때마다 npm install이 재실행되는 것을 피할 수 있습니다.
COPY package*.json ./

# 프로덕션 종속 항목을 설치합니다.
# package-lock.json을 추가하면 'npm ci'로 전환하여 빌드를 가속화할 수 있습니다.
# RUN npm ci --only=production
RUN npm install --only=production

# 로컬 코드를 컨테이너 이미지에 복사합니다.
COPY . ./

# 컨테이너 시작 시 웹 서비스를 실행합니다.
ENTRYPOINT [ "npm", "start" ]

# Twistlock Container Defender - app embedded
ADD twistlock_defender_app_embedded.tar.gz /tmp
ENV DEFENDER_TYPE="appEmbedded"
ENV DEFENDER_APP_ID="helloworld-app"
ENV FILESYSTEM_MONITORING="true"
ENV WS_ADDRESS="wss://34.22.73.112:8084"
ENV DATA_FOLDER="/tmp"
ENV INSTALL_BUNDLE="eyJzZWNyZXRzIjp7ImRlZmVuZGVyLWNhLnBlbSI6Ii0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLVxuTUlJREhEQ0NBZ1NnQXdJQkFnSVFkVFE1bmk1dHo3VmRBZTZscVZ5RUhEQU5CZ2txaGtpRzl3MEJBUXNGQURBb1xuTVJJd0VBWURWUVFLRXdsVWQybHpkR3h2WTJzeEVqQVFCZ05WQkFNVENWUjNhWE4wYkc5amF6QWVGdzB5TkRBNVxuTURFd05UTTNNREJhRncweU56QTVNREV3TlRNM01EQmFNQ2d4RWpBUUJnTlZCQW9UQ1ZSM2FYTjBiRzlqYXpFU1xuTUJBR0ExVUVBeE1KVkhkcGMzUnNiMk5yTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ1xuQVFFQTNPaERUaVpiam1wWURMVzRDdjdqR3VSSzlieElaczhJaENNUzFnSkllTkE0NU80blE5dkpWU3VOMnlCTlxuWHpRb2JHakhTMWZvVnNDTGxId29lYnN3SXpuZG5hanFJaDd6aGp1Nld5NE9yanlJWWVYbVdlYWNZaVFDN3UxYlxuYXFXL0t5c0YxelJTYXN3cTV0bTR4b1pwTXBkV0NMbkdPbE9nOUpQbUI5TmJSRytWd3FOMVNyNy9IaUkvWXM1VFxuS3o3bnFZKzJZQkFzeklsNmthN3hOckc2MEdnbTJLVDdqZ1pweC9FN2M3bjZ0Y0JVT0NLQ2pVQW1TSll1WkM4Q1xuelBvRmhFbGhQdUZZWjRtbUtQcTRUck90TStFaENVYmlueWxQcjNrWGZicE1Gd3U0ZGJzOHNESEtqOTBiQ1FIZ1xuSFAvejcyTGZBZjlRR2kxWWFHbjVJWEhlNlFJREFRQUJvMEl3UURBT0JnTlZIUThCQWY4RUJBTUNBcXd3RHdZRFxuVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVU5WlpFU090OG1NZ0FRYytSeEJtYWE3eWh6aUV3RFFZSlxuS29aSWh2Y05BUUVMQlFBRGdnRUJBQVo1ZmdWNU5QTk43VHNESmpibHFYMVhiQU9pd3VZR20wK1dJM2RGNG9nbFxuQWIxSjZWUHpJQVJwbmRnUGVidnpQYUdrUWdtWHFTSngyVVo0RTVrQ0svK0lVOVJuaElmMTJsZ0taVWRPYWlsV1xuYVZFSE9STWNXZEhmdms3VklUOVM0dEFHdkl4RWtxVHBHN0VSekJURGw4R0wrY1g5KzZJYlVCV1dTOVdCMmIyTlxuQU1nYzJESzVlcExwaSthRlQ3UjZ4czRES0hoaUEyYmEwMTBRdGs3UW94aU1jTURaUGZlZFNGd3VMS2l2T0VhNFxuVHovOVZYQVpGam9PeC9GeTRvMGJXYU9KRFBac25PbDJGbEhoSUJaZjh0cFd6SkVoaVZmRFp3ZElvbWRVL0ZkbVxuaDZkMEFKZUdNdkpxbWZNeDdEUTkvNklxbmdmbUhRdmpZczJXNXVWZE8yZz1cbi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS1cbiIsImRlZmVuZGVyLWNsaWVudC1jZXJ0LnBlbSI6Ii0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLVxuTUlJRFBEQ0NBaVNnQXdJQkFnSVJBUFQ5RmcxSXVQVTFTODFBU1l6alo5QXdEUVlKS29aSWh2Y05BUUVMQlFBd1xuS0RFU01CQUdBMVVFQ2hNSlZIZHBjM1JzYjJOck1SSXdFQVlEVlFRREV3bFVkMmx6ZEd4dlkyc3dIaGNOTWpRd1xuT1RBeE1EVXpOekF3V2hjTk1qY3dPVEF4TURVek56QXdXakFvTVJJd0VBWURWUVFLRXdsVWQybHpkR3h2WTJzeFxuRWpBUUJnTlZCQU1UQ1d4dlkyRnNhRzl6ZERDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ1xuZ2dFQkFMVHMzQnNFZVhWcEZWdEhxQjJLL2owNUIzeVpRM2NTL01aTm5lVnc5b3o5cFJEUk9wUExLbXJlc29wd1xua0R4RkYvZWJLaGJXSXlkZ3NIcDkva1laL0Y3bU12dk5HS1RqRTNCVjcrNjNIazJKVmM1Nm9jN1NKM0pqNythR1xuZk9YRUpObUdSRngzVUd1SzlDdGR4cUN2VndUWUxyNTUrZ3FUNHRpaUMwbTFramVqVkdMaU40ZEluY3d1eVdaWVxuTE95Ulh6bi9yaFJKY1o2UDhWZlo2WW1zVUczOU1peS9Pa1B2RHNadTJ5UHgxd05IL216MjN5TUVZVDM4alVNMFxuSk9ZZ0hHVTVmMW5WblpqTlFYdHhUakozYVZyaThBZDdyNlhjb1B1QU1scFVpaW9UYi9QUFZKNHRJdnl1WnlqQVxuNmN0WWRYRnVHZFFaZHdtZGs2U0t3bjdkRzhzQ0F3RUFBYU5oTUY4d0RnWURWUjBQQVFIL0JBUURBZ2VBTUJNR1xuQTFVZEpRUU1NQW9HQ0NzR0FRVUZCd01DTUF3R0ExVWRFd0VCL3dRQ01BQXdId1lEVlIwakJCZ3dGb0FVOVpaRVxuU090OG1NZ0FRYytSeEJtYWE3eWh6aUV3Q1FZRktnUUJBZ2NFQURBTkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQVxuYnhWWGVqdXYzeGpoSFlwbUdxc1dlRGtabXoxR1ZhS2J6UDI4Q2FscUdkNUhzWUJ6RjJ0bklEUm5hcU94MVo1V1xubmtQTUdISnIybk1EdkNpS21tRThPZTJjV21hMkJiUDdRMzdReGF2Tzgva3JLK3FwRnp0Y0huR2VnL1NhUnVCTVxuTUNkaWUyN1B0aHYrS1VMdEgxNE1pK1dKY0NhOWtONk1TUGlxa1YvQjQ0V1c4cUJRcFNjUmUvL0tZVkYvNGZPS1xuMlYySC8zYUJnZiswbFdXUE80Nm5ZQ1h1R1hSYk9abHFBeWR6VkI1QWJvTEpkSDlkSW02bkJ0K2x6eDZKQm1aTlxuVHAwUEEyNk9kZVdoOEhhWUQ3SnVKTklqNWdheDlxYjJwWS9Db0taWTV5QjVWWXV5RG5tZXRFaFlXV1FaRnUzbFxuUlRNbFZJWWV3M0FZYUR6bEcxazlJZz09XG4tLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tXG4iLCJkZWZlbmRlci1jbGllbnQta2V5LnBlbSI6Ii0tLS0tQkVHSU4gUlNBIFBSSVZBVEUgS0VZLS0tLS1cblByb2MtVHlwZTogNCxFTkNSWVBURURcbkRFSy1JbmZvOiBBRVMtMjU2LUNCQyxkMzJlZmI5YmQ3ZjBmYjgzZDVlZTdkNmQ2YzZlYTIyMFxuXG5GUDJXQzRXSERTNEZoYys4MHZ6emZFYWdZWGlNcUVscVFQcEpKWU1SK0FUNVpXN3hKelFIWmpyMExpd3U3Q2hXXG40QTdjSmpzY1gzWGRoa2c2Y2JHdTJ0cWdqZ3ZjSExuS2phNFYwUEljdU5sallCd1JwbUs0dG1lVVFSd3VBSGVaXG41Ym5jZVlMUVFyV09MU1RhWXFTOTByQmNLbDBNQm5ydGVqZFZuWUIxMk8xejd6TWRKVDJneklkbUpqTGg4eFIxXG5Qbjk0bkI5TEtVKzFjQjg1QXZKM3huZVZGbE9ndWpqNm4rMUhjVmlOcWN5ZDRYQVpuckgrZ0kvNUVZRzJjbDhXXG5lRTNaSmNRZ3p1MWVBWi9DYUlaR1NnbEpVVFVsb2tXYStYQ2lVbjZJOHJwN052Q04yd01HakhYM2ZiNUpBa0tUXG5nY2YrcjhQZ1Brbm9GZ0ZnZ052UWowZGo4TWNIaWhieVNxaGNpQjRIU3BhSjA3NzN1SEo4K1hvTHhQNWlBNDBpXG5ad0NrbGM2ODVlSTA0UDVnQlcyUW1QeEFwdGdsQ1BNRmEyWW84RS9sdkhaMUIwdXRSWTk5RjNKQ1IwdzBvSlJVXG4rSGwwdzZSNFFZajVTSUcrQlYvS2QzREc4cnlTYk5tb3VmK2EvTE10cTdDM1lkVldhVDFTSDN6MitHaGNnbGsvXG5pSUFHRy9LVDlrZ04wQi9JRHpiREU2NmRJT3IxdVJYTjVrTVhienE0ZDc3V0psMTBPNU1aVWpZbGpYUXBQcGx2XG5uN05DSnQwZEluaWdaemJUU2NIajlNNXFlM1NJVWlaRnZ0S2RaRG45N3RDNG1KVEgzVkJjdmpuell5NlVJYWtYXG5oSFd6OHhieTUyaFd4MVp4MTkyQlZaM3JoQVpKbFFuSXEwOVVkUldlemJoeDNSclg5Vk9jNWNHRFpXa01wclZJXG5idUpqeTRpZ0lkeDFCQzlraC9ZYnNpY0FUVWZlZ3VqSm9ENGJ2T2tuNmo3L0FFNU95OFhOc0dYN0xnenhsLzdiXG51WjExelFSSDZvVmZBaHBZcS9KVmNDZDN3VE1OSjZ1ZDdzVE1TVGc1aGdNRVBGcWZOeHpZSkhlNG9MbmJVVmR1XG5raXRFYVNmbS9QU3pmaTQvdzg3ZUZKWmFjMnFNVFRoUmZkN1pybE5SZlVNWG1aR3lYejBZOXJHQ01WdXdhK0VLXG5HNXR2a2p2dUNKMGlRKzlEbURZMy8vbk02Q2R4M0NTME45dXRJY2hXS1IxMUd2dE9DKzVqekowZWJ5SUhpc1BNXG4rVUQ1czYxSzAwc0puNHpmZ0pIVkFRN1E4OWtndC8wd1dPUStPc2c0UVhCa0QwMTRxc0Rma1Q4UFY5VVlGdUZqXG5ES3kvUzVUSW1hMm5BeXM0MjBqWDhTK0t1N1FJbkkwQkZtNU1OMmZvcGliZ2pXRTdjampFZ3lxZE5URzVIUjdoXG5acG5wMFZQTmp1dXY5K1ZPdGJDSHlHNHQvOU9tSTdSYmFFVGlWL3pRdUlGVFMvakVGUjFMZG9uR1hrbmRuZFdxXG5Qa3A5dWI5K1FpNXM3cTdXdU1BelRVMFR6RGczSFVEMjlyOVJLYWYwQ2VoWEc0RTNlT2pTUFduZzZGSkZBZHRGXG5jWTN1MCswODVvbkdKbjdvWnUxVVNIMGZaTlhLZFl3QmpnZXdsK0lRZU9PVkx2QmZxY21vc0h0T08rUktWZEo5XG53Tmt1eDF1blBZQ081UEhpSnQ0eUNtZVhIckNLK0RpUE9SMzJyZmZac01hTU5sSjZsRWt3WklDM3FXMnI5M29oXG5PbjB0YkcyVjV3RXY1UHdMRzAvTVBtMHNpaGlBUWpGZlRJaE5Hem1mQlpEQ1lYUlJTUGlMamdPMGZBelgwSVIzXG5aVFpNSXBFdWZKMzh3bkVtWGJLZ3pQZVRLVm9lYXU4Z1RpK2VTK2RncTk0VnpxenJ3TlVhclplMm13VVhFKzZzXG5hck1ZaUlxYk9rbHpreU5VZkNKSllKbjd6RUF2Q1hLK09EajRYSVZyMWxBNk42SmY5NEtONXdqQ2szdUNVeHprXG54Um9uQ01OMUFPN09Kc0FPZDhMTU5EdTJ5QjQ3NnI3bnBCT0xZOUxzVWpqdG1qQzExc21saURSYzg2MzhFK1lGXG4tLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLVxuIiwic2VydmljZS1wYXJhbWV0ZXIiOiI1NkNWWVpnMzRONkZuUFlaZy9tV1RjVU8wamlUc2ZRR1BpaGZ0RmRaWWM1VG5TVmtvMHdWcE5xZU8ydnlKdHl3c1oveitKNm1RdXdwZDhjZ0JHdnJiZz09In0sImdsb2JhbFByb3h5T3B0Ijp7Imh0dHBQcm94eSI6IiIsIm5vUHJveHkiOiIiLCJjYSI6IiIsInVzZXIiOiIiLCJwYXNzd29yZCI6eyJlbmNyeXB0ZWQiOiIifX0sIm1pY3Jvc2VnQ29tcGF0aWJsZSI6ZmFsc2UsImltYWdlU2NhbklEIjoiOTY1ZjU3YzctNjVhMS1kNjA0LTBiNTUtYWUzZWNkNzYwM2NhIn0="
ENV FIPS_ENABLED="false"
ENTRYPOINT ["/tmp/defender", "app-embedded", "npm", "start"]
